// Place all the behaviors and hooks related to the matching controller here.
// All this logic will automatically be available in application.js.

var update_metrics = function(data) {
	$.each(data, function(index, val) {
		$.each(val, function(index, val) {
			var metric_content = $("#project_" + val.project_id + "_" + val.metric_name + "_metric")
			metric_content.find(".metric_score").html(val.score)
			metric_content.find(".metric_image").html(val.image)
		});
	});
};

var update_date_label = function(data) {
	$("#date-label").html(data[0][0].created_at.split("T")[0]);
}

var ready = function() {
	$( "#date-slider" ).slider({
      value: 100,
      min: -$("#date-slider").attr("num_days_from_min"),
      max: 0,
      step: 1,
      slide: function(event, ui) {
        $.ajax({
			url: 'projects/metrics_on_date',
			type: 'POST',
			dataType: 'json',
			data: { days_from_now: -1 * ui.value },
		})
		.done(function(data) {
			console.log(data)
			update_metrics(data);
			update_date_label(data);
		})
		.fail(function() {
			console.log("error");
		})
      }
    });
}

$(document).ready(ready)
$(document).on('turbolinks:load', ready)